{"id":"quasar-0c2","title":"Keyboard shortcuts for pause, resume, stop, and retry","description":"## Problem\n\nThe TUI supports navigation (j/k, enter/esc for drill-down, q) and gate decisions, but has no way to pause, stop, or retry execution. Users must create PAUSE/STOP files manually. The `keys.go` defines `Pause`, `Stop`, and `Retry` bindings but they aren't wired up in `model.go`'s `handleKey`.\n\n## Current State\n\nThe model already has:\n- `handleKey` dispatching to `moveUp/moveDown/drillDown/drillUp` based on `ViewDepth`\n- `handleGateKey` for gate prompt overlay\n- `buildFooter()` switching between `LoopFooterBindings`, `NebulaFooterBindings`, `NebulaDetailFooterBindings`, and `GateFooterBindings`\n- `NebulaDir` is NOT yet on `AppModel` — needs to be added\n\nThe nebula `Watcher` already monitors for PAUSE/STOP intervention files at runtime.\n\n## Solution\n\nWire the keyboard shortcuts to actual execution control by writing intervention files that the nebula Watcher already monitors:\n\n### Pause/Resume (`p` key)\n- On first press: write a `PAUSE` file to the nebula directory (same mechanism `handlePause` already reads)\n- Toggle behavior: if paused, pressing `p` again removes the PAUSE file to resume\n- Update status bar to show \"PAUSED\" indicator when paused\n- Send a `MsgPauseToggled{Paused bool}` message for UI state\n- Only active at `DepthPhases` in nebula mode (not when drilled into a phase or in loop mode)\n\n### Stop (`s` key)\n- Write a `STOP` file to the nebula directory\n- Show confirmation in the status bar: \"Stopping...\"\n- The existing `handleStop` in worker.go picks it up\n- Only active in nebula mode at `DepthPhases` (not loop mode, where there's only one task)\n\n### Retry (`r` key)\n- Only meaningful when viewing a failed phase in nebula mode (at `DepthPhases` or `DepthPhaseLoop`)\n- Sends a signal to retry the selected phase (reset phase status in state, re-dispatch)\n- Requires the selected phase to be in `PhaseFailed` state\n\n### Implementation\n- Add `Paused bool`, `Stopping bool`, `NebulaDir string` fields to `AppModel`\n- In `handleKey`, add cases for `m.Keys.Pause`, `m.Keys.Stop`, `m.Keys.Retry` — check `m.Mode` and `m.Depth` before acting\n- Write intervention files via `os.WriteFile`/`os.Remove` (the path is `filepath.Join(m.NebulaDir, \"PAUSE\")` etc.)\n- Add new message types: `MsgPauseToggled`, `MsgStopRequested`\n- Update `buildFooter()` to conditionally enable pause/stop/retry based on mode, depth, and state\n- Pass `NebulaDir` into `AppModel` from `cmd/nebula.go` via `tui.NewProgramRaw` options or a post-init message\n\n## Files to Modify\n\n- `internal/tui/model.go` — Add `Paused`, `Stopping`, `NebulaDir` fields; wire key handlers; handle new messages\n- `internal/tui/msg.go` — Add `MsgPauseToggled`, `MsgStopRequested`\n- `internal/tui/keys.go` — Ensure pause/stop/retry bindings are enabled/disabled based on mode context\n- `internal/tui/statusbar.go` — Show \"PAUSED\" / \"STOPPING\" indicators\n- `internal/tui/footer.go` — `buildFooter()` already switches on mode/depth; update to show pause/stop when at `DepthPhases`\n- `internal/tui/tui.go` — Accept `NebulaDir` option for intervention file paths\n- `cmd/nebula.go` — Pass nebula dir into TUI (e.g. via a `MsgNebulaInit` field or `AppModel` setter)\n\n## Acceptance Criteria\n\n- [ ] `p` toggles pause (writes/removes PAUSE file) when at phase table level\n- [ ] `s` writes STOP file in nebula mode at phase table level\n- [ ] Status bar shows PAUSED/STOPPING state\n- [ ] Footer shows relevant controls based on mode and drill-down depth\n- [ ] Controls are disabled in loop mode and when drilled into agent output\n- [ ] Retry works on failed phases\n- [ ] Tests for pause toggle logic\n- [ ] `go build` and `go test ./...` pass","status":"open","priority":1,"issue_type":"feature","owner":"aa11salm@gmail.com","created_at":"2026-02-16T14:54:02.934783-05:00","created_by":"Aaron","updated_at":"2026-02-16T14:54:02.934783-05:00","labels":["quasar","tui"]}
{"id":"quasar-1ya","title":"Error and completion overlay screens","description":"## Problem\n\nWhen the loop or nebula finishes (success, error, max cycles, budget exceeded), the TUI just sets `Done = true` and `DoneErr` but doesn't communicate the outcome visually. The user has to quit and read stderr. Similarly, errors during execution are added to a `Messages []string` slice but aren't surfaced prominently. Phase-level errors (`MsgPhaseError`) are also just appended to messages.\n\n## Current State\n\nThe model handles `MsgLoopDone{Err}` and `MsgNebulaDone{Results, Err}` by setting `m.Done = true` and `m.DoneErr`. Phase errors (`MsgPhaseError`) set `PhaseFailed` status on the `NebulaView` and append to `m.Messages`. General errors (`MsgError`) and info (`MsgInfo`) just append to `m.Messages`. The `Messages` slice is never rendered in the view — it's effectively invisible.\n\n## Solution\n\n### Completion Overlay\n- When `MsgLoopDone` or `MsgNebulaDone` arrives, show a centered overlay:\n  - **Success**: Green border, checkmark, \"Task complete\" with total cost and duration\n  - **Max cycles**: Yellow border, warning icon, \"Max cycles reached (N)\" with suggestion\n  - **Budget exceeded**: Red border, \"Budget exceeded ($X / $Y)\"\n  - **Error**: Red border, error message\n  - **Nebula results**: Summary table of phase outcomes (done/failed/skipped counts from `MsgNebulaDone.Results`)\n- Overlay has \"Press q to exit\" hint at bottom\n- The underlying view (at whatever drill-down depth the user was at) is still visible (dimmed) behind the overlay\n\n### Error Toast\n- When `MsgError` or `MsgPhaseError` arrives during execution (not at completion), show a brief toast notification\n- Toast appears at the bottom of the screen above the footer for 5 seconds, then fades\n- Red background, white text, shows the error message (phase errors prefixed with `[phaseID]`)\n- Multiple errors queue up\n\n### Implementation\n- New file: `internal/tui/overlay.go` — shared overlay rendering (centered box on dimmed background)\n- Add `Overlay *CompletionOverlay` field to `AppModel`\n- Add `Toasts []Toast` with auto-dismiss via `tea.Tick`\n- Completion overlay takes precedence over normal key handling (only `q` to exit)\n- Gate overlay and completion overlay should not conflict (gate resolves before completion)\n\n## Files to Modify\n\n- `internal/tui/overlay.go` — New file: CompletionOverlay and Toast types with rendering\n- `internal/tui/model.go` — Add overlay/toast fields; handle `MsgLoopDone`/`MsgNebulaDone` to create overlay; handle `MsgError`/`MsgPhaseError` to create toasts; toast auto-dismiss; overlay key handling\n- `internal/tui/msg.go` — Add `MsgToastExpired{ID int}` for auto-dismiss\n\n## Acceptance Criteria\n\n- [ ] Completion overlay appears on task/nebula completion\n- [ ] Overlay shows appropriate icon, color, and message for each outcome\n- [ ] Nebula completion overlay shows phase result summary (done/failed/skipped)\n- [ ] Underlying view is visible but dimmed behind overlay\n- [ ] Error toasts appear briefly during execution (both `MsgError` and `MsgPhaseError`)\n- [ ] Toasts auto-dismiss after 5 seconds\n- [ ] `q` exits from the completion overlay\n- [ ] Tests for overlay rendering\n- [ ] `go build` and `go test ./internal/tui/...` pass","status":"open","priority":3,"issue_type":"feature","owner":"aa11salm@gmail.com","created_at":"2026-02-16T14:54:02.819869-05:00","created_by":"Aaron","updated_at":"2026-02-16T14:54:02.819869-05:00","labels":["quasar","tui"]}
{"id":"quasar-2vg","title":"Animated progress bars and enhanced spinners","description":"## Problem\n\nThe current TUI uses a basic `spinner.Dot` for working agents. There's no visual progress bar for nebula completion, no elapsed time per agent, and no budget consumption indicator. Per-phase LoopViews each have their own spinner but they're all the same plain dot style.\n\n## Current State\n\nThe model receives `MsgNebulaProgress{Completed, Total, OpenBeads, ClosedBeads, TotalCostUSD}` and stores counts in `StatusBar`. Each `LoopView` (both the top-level one and per-phase ones in `PhaseLoops`) has a `Spinner spinner.Model`. The `StatusBar` struct has `Cycle`, `MaxCycles`, `CostUSD`, `MaxBudget` fields. Agent elapsed time is not tracked — `AgentEntry` has `DurationMs` (set on completion) but no start time.\n\n## Solution\n\n### Nebula Progress Bar\n- Add a `progress.Model` (from `charmbracelet/bubbles`) to the status bar area\n- Shows completion percentage: filled bar with phase count label\n- Color transitions: blue → green as progress increases\n- Update on every `MsgNebulaProgress`\n\n### Agent Spinners\n- Use `spinner.MiniDot` or `spinner.Pulse` for a more refined look\n- Color the spinner to match the agent role (blue for coder, yellow for reviewer)\n- Track agent start time: add `StartedAt time.Time` to `AgentEntry`, set on `StartAgent()`\n- Show elapsed time next to the spinner that ticks up: `working... 12s`\n- This applies to both top-level `LoopView` and per-phase `PhaseLoops` entries\n\n### Budget Bar\n- Small inline progress indicator in the status bar showing budget consumption\n- Format: `$1.24 ━━━━━━░░░░ $10.00` (filled proportional to spend/budget)\n- Changes color from green → yellow → red as budget approaches limit\n\n### Cycle Progress (Loop Mode)\n- Show `cycle 2/5` with a mini bar in the status bar: `[██░░░]`\n\n## Files to Modify\n\n- `internal/tui/statusbar.go` — Add progress bar rendering for budget and cycle/phase progress\n- `internal/tui/loopview.go` — Add `StartedAt` to `AgentEntry`, enhanced spinner with elapsed time, colored per role\n- `internal/tui/nebulaview.go` — Enhanced spinner with elapsed time for working phases\n- `internal/tui/model.go` — Track elapsed time per agent (set `StartedAt` on `MsgAgentStart` and `MsgPhaseAgentStart`); pass `MsgTick` to per-phase LoopViews for time updates\n\n## Acceptance Criteria\n\n- [ ] Nebula mode shows a visual progress bar in the status bar area\n- [ ] Budget consumption is visualized inline\n- [ ] Working agents show elapsed time alongside spinner (both in loop and per-phase views)\n- [ ] Spinners are colored per agent role\n- [ ] Loop mode shows cycle progress mini-bar\n- [ ] All indicators update smoothly without flicker\n- [ ] Tests for progress bar string formatting\n- [ ] `go build` and `go test ./internal/tui/...` pass","status":"open","priority":2,"issue_type":"feature","owner":"aa11salm@gmail.com","created_at":"2026-02-16T14:54:03.04187-05:00","created_by":"Aaron","updated_at":"2026-02-16T14:54:03.04187-05:00","labels":["quasar","tui"]}
{"id":"quasar-j2k","title":"Graceful terminal resize and narrow-width handling","description":"## Problem\n\nThe TUI currently receives `tea.WindowSizeMsg` and updates width/height, but the layout doesn't adapt well to narrow terminals (\u003c 60 columns) or very short terminals (\u003c 15 rows). Status bar text wraps, progress bars break, and the detail panel may have zero height. The breadcrumb bar and per-phase drill-down views also need width-aware rendering.\n\n## Current State\n\nThe model handles `tea.WindowSizeMsg` by updating `m.Width`, `m.Height`, `m.StatusBar.Width`, and `m.Detail.SetSize()`. The `detailHeight()` helper computes available height. The `renderMainView()` sets `lv.Width` or `nv.Width` before calling `View()`. The breadcrumb is rendered via `renderBreadcrumb()` with no width awareness. Per-phase `LoopView`s in `PhaseLoops` also get their width set in `renderMainView()`.\n\n## Solution\n\n### Minimum Size Handling\n- Define minimum usable dimensions: 40 columns, 10 rows\n- Below minimum: show a centered \"Terminal too small\" message instead of the broken layout\n- At the boundary: hide optional elements (detail panel, progress bars, breadcrumb) to fit\n\n### Adaptive Layout\n- Status bar: truncate nebula name with ellipsis when terminal is narrow\n- Breadcrumb: truncate phase IDs with ellipsis, hide \"output\" segment if too narrow\n- Progress bars: switch to compact format (percentage only) below 60 columns\n- Phase table: truncate phase IDs with ellipsis when they don't fit\n- Footer: show abbreviated key hints below 60 columns (`↑↓` instead of `↑/k:up  ↓/j:down`)\n- Detail panel: auto-collapse when terminal height \u003c 20 rows\n\n### Resize Transitions\n- On resize, recalculate all layout dimensions\n- Reflow the detail panel viewport content\n- Ensure the cursor remains valid in all views: clamp `NebulaView.Cursor`, `LoopView.Cursor`, and per-phase `PhaseLoops[*].Cursor` if their list shrunk\n- Propagate width to per-phase LoopViews on resize\n\n## Files to Modify\n\n- `internal/tui/model.go` — Minimum size check in `View()`, adaptive layout logic, cursor clamping on resize, propagate width to `PhaseLoops`\n- `internal/tui/statusbar.go` — Truncation with ellipsis for narrow terminals\n- `internal/tui/footer.go` — Compact mode for narrow terminals\n- `internal/tui/loopview.go` — Width-aware rendering\n- `internal/tui/nebulaview.go` — Truncate phase IDs with ellipsis\n- `internal/tui/detailpanel.go` — Auto-collapse logic\n\n## Acceptance Criteria\n\n- [ ] Terminal below 40x10 shows \"Terminal too small\" message\n- [ ] Status bar and breadcrumb truncate cleanly at narrow widths\n- [ ] Footer adapts to compact mode\n- [ ] Detail panel auto-collapses on short terminals\n- [ ] Cursor remains valid after resize that shrinks the list (all views including per-phase)\n- [ ] No panics or rendering glitches during rapid resize\n- [ ] Tests for truncation helpers and layout calculations\n- [ ] `go build` and `go test ./internal/tui/...` pass","status":"open","priority":3,"issue_type":"task","owner":"aa11salm@gmail.com","created_at":"2026-02-16T14:54:03.148185-05:00","created_by":"Aaron","updated_at":"2026-02-16T14:54:03.148185-05:00","labels":["quasar","tui"]}
{"id":"quasar-u6u","title":"Rich detail panel with formatted output and scroll indicators","description":"## Problem\n\nThe detail panel is a plain viewport that dumps raw agent output text. There's no formatting, no scroll position indicator, and no contextual information about the selected item. The panel only appears at `DepthAgentOutput` — it could also be useful at `DepthPhaseLoop` to show phase summary info.\n\n## Current State\n\nThe TUI has a three-level drill-down: `DepthPhases` (phase table) → `DepthPhaseLoop` (per-phase cycle timeline) → `DepthAgentOutput` (agent output in detail panel). The detail panel (`DetailPanel` in `detailpanel.go`) wraps a `viewport.Model` with `SetContent(title, content)`. The `updateDetailFromSelection()` method in `model.go` populates it:\n- In loop mode: shows `agent.Output` from the selected `AgentEntry`\n- In nebula mode at `DepthPhaseLoop`/`DepthAgentOutput`: shows agent output from `PhaseLoops[FocusedPhase].SelectedAgent()`\n- Currently only visible when `showDetailPanel()` returns true (at `DepthAgentOutput`)\n\n## Solution\n\n### Contextual Headers\n- When a loop agent row is selected: show role, cycle number, duration, cost, and issue count as a formatted header above the output\n- When drilled into a nebula phase (`DepthPhaseLoop`): show phase ID, title, dependencies, status, cost, cycles used as a summary header — even before drilling into agent output\n- When at `DepthAgentOutput` inside a phase: show both phase context and agent context\n\n### Output Formatting\n- Wrap agent output in a styled box with the role as title\n- Highlight key patterns in output: `APPROVED` in green, `ISSUE:` blocks in yellow, `SEVERITY: critical` in red\n- Truncate very long outputs with a \"(truncated -- N lines)\" indicator\n\n### Scroll Indicators\n- Show scroll position: `up 12 more` at top, `down 34 more` at bottom when content overflows\n- Use the viewport's built-in scroll percentage or compute from `YOffset` and content height\n- Style the indicators dimly so they don't distract\n\n### Empty State\n- When no item is selected or detail is collapsed, show a hint: \"Press enter to expand details\"\n- When an agent is still working, show \"Output will appear when the agent completes\" (already done in `updateDetailFromSelection`)\n\n### Show Detail at Phase Level\n- Optionally show the detail panel at `DepthPhaseLoop` too (not just `DepthAgentOutput`) to display a phase summary card. Update `showDetailPanel()` accordingly.\n\n## Files to Modify\n\n- `internal/tui/detailpanel.go` — Contextual headers, output formatting helpers, scroll indicators, empty states\n- `internal/tui/model.go` — Update `updateDetailFromSelection()` to build richer context; optionally show detail at `DepthPhaseLoop`; update `showDetailPanel()`\n- `internal/tui/loopview.go` — Expose selected entry context (role, cycle, cost, duration via `SelectedAgent()`)\n- `internal/tui/nebulaview.go` — Expose selected phase context via `SelectedPhase()` (already exists, returns `*PhaseEntry`)\n\n## Acceptance Criteria\n\n- [ ] Detail panel shows contextual header for selected item\n- [ ] Phase summary shown when drilled into a phase's cycle timeline\n- [ ] Agent output has key patterns highlighted (APPROVED, ISSUE, SEVERITY)\n- [ ] Scroll indicators show when content overflows\n- [ ] Empty states provide helpful hints\n- [ ] Long output is truncated with indicator\n- [ ] Tests for output formatting helpers\n- [ ] `go build` and `go test ./internal/tui/...` pass","status":"open","priority":2,"issue_type":"feature","owner":"aa11salm@gmail.com","created_at":"2026-02-16T14:54:02.711652-05:00","created_by":"Aaron","updated_at":"2026-02-16T14:54:02.711652-05:00","labels":["quasar","tui"]}
