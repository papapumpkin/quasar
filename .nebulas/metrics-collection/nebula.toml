[nebula]
name = "metrics-collection"
description = "Instrument the Coordinator and WorkerGroup with runtime metrics for phase execution, conflicts, and cost — Layer 2 of the relativity coordination model"

[defaults]
type = "feature"
priority = 2
labels = ["quasar", "nebula", "relativity"]

[execution]
max_workers = 1
max_review_cycles = 5
max_budget_usd = 50.0

[context]
repo = "github.com/papapumpkin/quasar"
working_dir = "."
goals = [
    "Define a Metrics struct capturing all runtime signals from phase execution",
    "Instrument ChannelCoordinator to record lock wait times, conflict counts, and broadcast events",
    "Instrument WorkerGroup to record phase duration, review cycles, cost, and restart counts",
    "Persist metrics alongside nebula state for post-run analysis",
    "Expose live metrics via a 'quasar nebula status' command",
]
constraints = [
    "Follow existing Go conventions from CLAUDE.md",
    "No external dependencies — stdlib only",
    "Metrics collection must be zero-cost when no observer is attached",
    "All UI output goes to stderr via ui.Printer",
    "Must not change existing WorkerGroup/Coordinator behavior — observation only",
]

[dependencies]
requires_nebulae = ["local-parallelism"]
